<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Assessing variable importance in survival analysis using machine learning • survML</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assessing variable importance in survival analysis using machine learning">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">survML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/conditional_survival.html">Estimating a conditional survival function using off-the-shelf machine learning tools</a></li>
    <li><a class="dropdown-item" href="../articles/current_status.html">Estimating a covariate-adjusted survival function using current status data</a></li>
    <li><a class="dropdown-item" href="../articles/variable_importance.html">Assessing variable importance in survival analysis using machine learning</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cwolock/survML/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Assessing variable importance in survival analysis using machine learning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cwolock/survML/blob/main/vignettes/variable_importance.Rmd" class="external-link"><code>vignettes/variable_importance.Rmd</code></a></small>
      <div class="d-none name"><code>variable_importance.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cwolock/survML" class="external-link">survML</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: SuperLearner</span></span>
<span><span class="co">#&gt; Loading required package: nnls</span></span>
<span><span class="co">#&gt; Loading required package: gam</span></span>
<span><span class="co">#&gt; Loading required package: splines</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loaded gam 1.22-5</span></span>
<span><span class="co">#&gt; Super Learner</span></span>
<span><span class="co">#&gt; Version: 2.0-29</span></span>
<span><span class="co">#&gt; Package created on 2024-02-06</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">72924</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>survML</code> package includes functions that can be used
to estimate model-free, algorithm-agnostic variable importance when the
outcome of interest is subject to right censoring. Specifically, this
functionality is aimed at estimating <em>intrinsic</em> variable
importance, which is the population-level predictiveness potential of a
feature or group of features.</p>
<p>Suppose we have access to a vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
of features, which we wish to use to make a prediction involving
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>,
a time-to-event outcome. We use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
to denote the right censoring variable. The observed data are given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>,</mo><mi>Y</mi><mo>,</mo><mi>Δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(X, Y, \Delta)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mo>:=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>C</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta := I(T \leq C)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>:=</mo><mtext mathvariant="normal">min</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>,</mo><mi>C</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y := \text{min}(T, C)</annotation></semantics></math>.
For an index set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
we use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>s</mi></msub><annotation encoding="application/x-tex">X_s</annotation></semantics></math>
to denote the elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
with index in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mo>−</mo><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">X_{-s}</annotation></semantics></math>
its complement. For a given prediction task (say, estimating the
probability that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is smaller than some landmark time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>)
and prediction function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>,
we require a measure of predictiveness. We let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(f, P_0)</annotation></semantics></math>
denote the predictiveness of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
under sampling from distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>0</mn></msub><annotation encoding="application/x-tex">P_0</annotation></semantics></math>.
We define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mrow><mn>0</mn><mo>,</mo><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">f_{0,s}</annotation></semantics></math>
as the <em>oracle prediction function</em> excluding features with index
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>;
this is the best possible prediction function, according to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>V</mi><annotation encoding="application/x-tex">V</annotation></semantics></math>,
that uses only
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mo>−</mo><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">X_{-s}</annotation></semantics></math>.</p>
<p>For intrinsic variable importance, we consider nested index sets
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>⊂</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">r \subset s</annotation></semantics></math>
and define the importance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mi>s</mi><mo>\</mo><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">X_{s \setminus r}</annotation></semantics></math>
relative to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>s</mi></msub><annotation encoding="application/x-tex">X_s</annotation></semantics></math>
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>f</mi><mrow><mn>0</mn><mo>,</mo><mi>r</mi></mrow></msub><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>f</mi><mrow><mn>0</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(f_{0,r}, P_0) - V(f_{0,s}, P_0)</annotation></semantics></math>;
this is the difference in maximum achievable predictiveness when only
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
is excluded compared to when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
is excluded. We refer to this parameter as a variable importance measure
(VIM). Colloquially, we refer to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mo>−</mo><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">X_{-r}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mo>−</mo><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">X_{-s}</annotation></semantics></math>
as the ‘large’ and ‘small’ feature groups, respectively. Variable
importance is assessed by comparing the predictiveness of a model using
the large feature group to that of a model using the small feature
group.</p>
<p>Due to right censoring, the VIM estimation procedure requires
estimates of the conditional survival functions of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
which we define pointwise as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><msub><mi>P</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>&gt;</mo><mi>t</mi><mo>∣</mo><mi>X</mi><mo>=</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">S_0(t \mid x) := P_0(T &gt; t \mid X = x)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><msub><mi>P</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>C</mi><mo>&gt;</mo><mi>t</mi><mo>∣</mo><mi>X</mi><mo>=</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G_0(t \mid x) := P_0(C &gt; t \mid X = x)</annotation></semantics></math>,
respectively. These functions must be estimated over the interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>τ</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">(0, \tau]</annotation></semantics></math>
and may be obtained from any conditional survival estimation algorithm.
This may be as simple as a Cox proportional hazards model (Cox, 1972) or
parametric survival regression model, or as complex as a stacked
regression procedure such as survival Super Learner (Westling et al.,
2023) or global survival stacking (Wolock et al., 2024).</p>
<p>We also require estimates of the oracle prediction functions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mrow><mn>0</mn><mo>,</mo><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">f_{0,r}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mrow><mn>0</mn><mo>,</mo><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">f_{0,s}</annotation></semantics></math>,
which we refer to as the ‘large’ and ‘small’ oracle prediction
functions, respectively, and whose exact form depends on the chosen
predictiveness measure. For several commonly used measures, the oracle
prediction functions can be written in terms of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">S_0(\cdot \mid x)</annotation></semantics></math>.
The form of the oracle prediction function for the measures included in
<code>survML</code> is given in the Appendix.</p>
</div>
<div class="section level2">
<h2 id="example-predicting-recurrence-free-survival-time-in-cancer-patients">Example: Predicting recurrence-free survival time in cancer
patients<a class="anchor" aria-label="anchor" href="#example-predicting-recurrence-free-survival-time-in-cancer-patients"></a>
</h2>
<p>As an example, we consider estimating variable importance for
predicting recurrence-free survival using the <code>gbsg</code> dataset
in the <code>survival</code> package. The Kaplan-Meier estimate of the
survival curve for this dataset is shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cancer</span><span class="op">)</span></span>
<span><span class="va">km_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">rfstime</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">gbsg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">km_fit</span>, xlab <span class="op">=</span> <span class="st">"Time (days)"</span>, ylab <span class="op">=</span> <span class="st">"Recurrence-free survival probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variable_importance_files/figure-html/km-1.png" width="768"></p>
<p>We will consider time-varying AUC importance using landmark times of
1000 and 2000 days. The first step is to prepare the data. We use dummy
coding for factors. This means that to assess the importance of tumor
grade, for example, which has three levels, we create two dummy
variables called <code>tumgrad2</code> and <code>tumgrad3</code> and
consider them as a single feature group. We also consider the feature
groups defined by tumor-level features and patient-level features.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### variables of interest</span></span>
<span><span class="co"># rfstime - recurrence-free survival</span></span>
<span><span class="co"># status - censoring indicator</span></span>
<span><span class="co"># hormon - hormonal therapy treatment indicator</span></span>
<span><span class="co"># age - in years</span></span>
<span><span class="co"># meno - 1 = premenopause, 2 = post</span></span>
<span><span class="co"># size - tumor size in mm</span></span>
<span><span class="co"># grade - factor 1,2,3</span></span>
<span><span class="co"># nodes - number of positive nodes</span></span>
<span><span class="co"># pgr - progesterone receptor in fmol</span></span>
<span><span class="co"># er - estrogen receptor in fmol</span></span>
<span></span>
<span><span class="co"># create dummy variables and clean data</span></span>
<span><span class="va">gbsg</span><span class="op">$</span><span class="va">tumgrad2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">gbsg</span><span class="op">$</span><span class="va">grade</span> <span class="op">==</span> <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">gbsg</span><span class="op">$</span><span class="va">tumgrad3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">gbsg</span><span class="op">$</span><span class="va">grade</span> <span class="op">==</span> <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">gbsg</span> <span class="op">&lt;-</span> <span class="va">gbsg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pid</span>, <span class="va">grade</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">gbsg</span><span class="op">$</span><span class="va">rfstime</span></span>
<span><span class="va">event</span> <span class="op">&lt;-</span> <span class="va">gbsg</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">gbsg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rfstime</span>, <span class="va">status</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove outcome </span></span>
<span></span>
<span><span class="co"># find column indices of features/feature groups</span></span>
<span><span class="va">X_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">age_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op">==</span> <span class="st">"age"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">meno_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op">==</span> <span class="st">"meno"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">size_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op">==</span> <span class="st">"size"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nodes_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op">==</span> <span class="st">"nodes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pgr_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op">==</span> <span class="st">"pgr"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">er_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op">==</span> <span class="st">"er"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hormon_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op">==</span> <span class="st">"hormon"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grade_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tumgrad2"</span>, <span class="st">"tumgrad3"</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">tum_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"nodes"</span>, <span class="st">"pgr"</span>, <span class="st">"er"</span>, <span class="st">"tumgrad2"</span>, <span class="st">"tumgrad3"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">person_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">X_names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"meno"</span>, <span class="st">"hormon"</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_group_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"meno."</span>, <span class="st">"size"</span>, <span class="st">"nodes"</span>,</span>
<span>                         <span class="st">"prog."</span>, <span class="st">"estro."</span>, <span class="st">"hormone"</span>, </span>
<span>                         <span class="st">"grade"</span><span class="op">)</span></span>
<span><span class="va">feature_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age_index</span>, <span class="va">meno_index</span>, <span class="va">size_index</span>, <span class="va">nodes_index</span>,</span>
<span>                    <span class="va">pgr_index</span>, <span class="va">er_index</span>, <span class="va">hormon_index</span>, <span class="va">grade_index</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="estimating-variable-importance-relative-to-all-features">Estimating variable importance relative to all features<a class="anchor" aria-label="anchor" href="#estimating-variable-importance-relative-to-all-features"></a>
</h3>
<p>First, we consider the importance of each of the feature groups
relative to the full feature vector. Here, the features of interest are
subtracted from the full feature vector, with importance measured by the
resulting loss in predictiveness.</p>
<p>First, we estimate the importance of age relative to the full feature
vector using the <code><a href="../reference/vim.html">vim()</a></code> function. In this case, we will
compare the AUC achieved when all features are included to the AUC when
all features except for age are included; therefore, the
<code>large_feature_vector</code> consists of all features, and the
<code>small_feature_vector</code> consists of all features except for
age.</p>
<p>There are three options for estimating the nuisance functions
(conditional survival functions and two oracle prediction functions).
Briefly, they include</p>
<ol style="list-style-type: decimal">
<li>Use <code>survML</code>’s built-in algorithms, which are based on
using <code><a href="../reference/stackG.html">stackG()</a></code> to estimate the conditional survival
functions and <code><a href="https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html" class="external-link">SuperLearner()</a></code> to estimate the oracle
prediction functions.</li>
<li>Provide a function to estimate each nuisance.</li>
<li>Provide pre-computed estimates for each nuisance.</li>
</ol>
<p>These are ordered from least to most flexible; in this vignette, we
focus on (1).</p>
<p>To reduce runtime, we use a very small Super Learner library to
estimate the conditional survival nuisance functions, as well as the two
oracle prediction functions. We also use two-fold cross-fitting (i.e,
set <code>cf_fold_num = 2</code>) and two-fold cross-validation for
nuisance estimation (i.e., set <code>V = 2</code> for each nuisance
estimator). In actual analyses, it is generally a good idea to use a
larger library of learners and more cross-fitting folds.</p>
<p>Note that we also set <code>sample_split = TRUE</code>. In order to
obtain valid inference under the null hypothesis of zero importance,
sample splitting is required. If this option is set to
<code>FALSE</code>, no p-value will be return, and caution should be
used when interpreting the resulting confidence interval.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># landmark times for AUC</span></span>
<span><span class="va">landmark_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>              time <span class="op">=</span> <span class="va">time</span>,</span>
<span>              event <span class="op">=</span> <span class="va">event</span>,</span>
<span>              X <span class="op">=</span> <span class="va">X</span>,</span>
<span>              landmark_times <span class="op">=</span> <span class="va">landmark_times</span>,</span>
<span>              large_feature_vector <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,</span>
<span>              small_feature_vector <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">age_index</span><span class="op">)</span><span class="op">]</span>,</span>
<span>              conditional_surv_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                        V <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                                        bin_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>              large_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                    V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>              small_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                    V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>              cf_fold_num <span class="op">=</span> <span class="fl">2</span>,</span>
<span>              sample_split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              scale_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">age_index</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="co">#&gt;   landmark_time est   var_est cil        ciu cil_1sided         p</span></span>
<span><span class="co">#&gt; 1          1000   0 0.6945702   0 0.08523649          0 0.5262368</span></span>
<span><span class="co">#&gt; 2          2000   0 1.0728425   0 0.09969271          0 0.5704072</span></span>
<span><span class="co">#&gt;   large_predictiveness small_predictiveness vim large_feature_vector</span></span>
<span><span class="co">#&gt; 1            0.7201543            0.7231159 AUC    1,2,3,4,5,6,7,8,9</span></span>
<span><span class="co">#&gt; 2            0.7050060            0.7149281 AUC    1,2,3,4,5,6,7,8,9</span></span>
<span><span class="co">#&gt;   small_feature_vector indx indx_name</span></span>
<span><span class="co">#&gt; 1      2,3,4,5,6,7,8,9    1       age</span></span>
<span><span class="co">#&gt; 2      2,3,4,5,6,7,8,9    1       age</span></span></code></pre></div>
<p>If we want to examine other features, we could simply repeat the
above call to <code><a href="../reference/vim.html">vim()</a></code>, substituting in the correct
<code>large_feature_vector</code> and <code>small_feature_vector</code>.
However, this would be computationally inefficient, as many of the
nuisance functions needed to estimate the other VIMs are identical to
what was required to estimate the importance of age. In this case, the
conditional survival functions of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>,
as well as the large oracle prediction function, are the same for each
feature group of interest; all that changes as we iterate over different
feature groups is the small oracle prediction function. Note that in
addition to the results data frame (<code>output$results</code>), the
<code><a href="../reference/vim.html">vim()</a></code> function also returned several other objects:</p>
<ul>
<li>
<code>folds</code> contains the cross-fitting and sample-splitting
folds that were generated by the call to <code><a href="../reference/vim.html">vim()</a></code>
</li>
<li>
<code>approx_times</code> is the grid of times that was used to
estimate the quantities needed for variable importance</li>
<li>
<code>conditional_surv_preds</code> contains the estimated
conditional survival functions of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
</li>
<li>
<code>large_oracle_preds</code> contains the estimated large oracle
prediction function (using all features)</li>
<li>
<code>small_oracle_preds</code> contains the estimated small oracle
prediction function (using all features except, in this case, for
age)</li>
</ul>
<p>As we examine the importance of other features relative to the full
feature vector, we can recycle <code>conditional_surv_preds</code> and
<code>large_oracle_preds</code> (which requires us to use the same
<code>folds</code> and <code>approx_times</code> as well). We can then
look at the results for all feature groups.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save the objects that we will reuse</span></span>
<span><span class="va">saved_conditional_surv_preds</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">conditional_surv_preds</span></span>
<span><span class="va">saved_large_oracle_preds</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">large_oracle_preds</span></span>
<span><span class="va">saved_folds</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">folds</span></span>
<span><span class="va">saved_approx_times</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">approx_times</span></span>
<span></span>
<span><span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">result</span> <span class="co"># save the results for age</span></span>
<span></span>
<span><span class="co"># iterate over other feature groups</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_group_names</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">indx_char</span> <span class="op">&lt;-</span> <span class="va">feature_groups</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="va">feature_group_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">indx_char</span>, split <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                event <span class="op">=</span> <span class="va">event</span>,</span>
<span>                X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                landmark_times <span class="op">=</span> <span class="va">landmark_times</span>,</span>
<span>                approx_times <span class="op">=</span> <span class="va">saved_approx_times</span>,</span>
<span>                large_feature_vector <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,</span>
<span>                small_feature_vector <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">indx</span><span class="op">]</span>,</span>
<span>                conditional_surv_preds <span class="op">=</span> <span class="va">saved_conditional_surv_preds</span>,</span>
<span>                large_oracle_preds <span class="op">=</span> <span class="va">saved_large_oracle_preds</span>,</span>
<span>                cf_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">cf_folds</span>,</span>
<span>                ss_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">ss_folds</span>,</span>
<span>                small_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                sample_split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                scale_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_char</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pooled_output</span>, <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span>, <span class="va">plot_title</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># plot results</span></span>
<span>  <span class="va">p_auc</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>landmark_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">landmark_time</span>,</span>
<span>                                  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>                                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1000 days"</span>, <span class="st">"2000 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">landmark_time</span>, <span class="va">est</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="op">{</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">est</span>, y <span class="op">=</span> <span class="va">Order</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html" class="external-link">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">cil</span>, xmax <span class="op">=</span> <span class="va">ciu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Estimated importance"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Feature group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>          breaks <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">Order</span>,</span>
<span>          labels <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">indx_name</span>,</span>
<span>        <span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">landmark_time</span>, dir <span class="op">=</span> <span class="st">"v"</span>, strip.position <span class="op">=</span> <span class="st">"right"</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">plot_title</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>              strip.placement <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">p_auc</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">p_auc</span> <span class="op">&lt;-</span> <span class="fu">plot_results</span><span class="op">(</span><span class="va">pooled_output</span>, <span class="st">"AUC variable importance relative to full feature vector"</span><span class="op">)</span></span>
<span><span class="va">p_auc</span></span></code></pre></div>
<p><img src="variable_importance_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We can also look at the importance of all tumor-level features and
all person-level features relative to the full feature vector.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># consider joint importance of all tumor-level and person-level features</span></span>
<span><span class="va">feature_group_names2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tumor"</span>, <span class="st">"person"</span><span class="op">)</span></span>
<span><span class="va">feature_groups2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tum_index</span>, <span class="va">person_index</span><span class="op">)</span></span>
<span><span class="co"># repeat the analysis for feature groups</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_group_names2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">indx_char</span> <span class="op">&lt;-</span> <span class="va">feature_groups2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="va">feature_group_names2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">indx_char</span>, split <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                event <span class="op">=</span> <span class="va">event</span>,</span>
<span>                X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                landmark_times <span class="op">=</span> <span class="va">landmark_times</span>,</span>
<span>                approx_times <span class="op">=</span> <span class="va">saved_approx_times</span>,</span>
<span>                large_feature_vector <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,</span>
<span>                small_feature_vector <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">indx</span><span class="op">]</span>,</span>
<span>                conditional_surv_preds <span class="op">=</span> <span class="va">saved_conditional_surv_preds</span>,</span>
<span>                large_oracle_preds <span class="op">=</span> <span class="va">saved_large_oracle_preds</span>,</span>
<span>                small_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                cf_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">cf_folds</span>,</span>
<span>                ss_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">ss_folds</span>,</span>
<span>                sample_split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                scale_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_char</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pooled_output</span>, <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">result</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">p_auc</span> <span class="op">&lt;-</span> <span class="fu">plot_results</span><span class="op">(</span><span class="va">pooled_output</span>, <span class="st">"AUC variable importance relative to full feature vector (groups)"</span><span class="op">)</span></span>
<span><span class="va">p_auc</span></span></code></pre></div>
<p><img src="variable_importance_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="estimating-variable-importance-relative-to-base-model">Estimating variable importance relative to base model<a class="anchor" aria-label="anchor" href="#estimating-variable-importance-relative-to-base-model"></a>
</h3>
<p>Next, we consider the importance of each of the tumor-level features
relative to a <em>baseline</em> set of person-level features. Here, the
feature of interest is added to a baseline set of features, with
importance measured by the resulting gain in predictiveness.</p>
<p>For this analysis, the large oracle predictions use baseline features
plus the feature of interest, and the small oracle predictions use only
baseline features. This means that we can recycle the small oracle
predictions over all feature groups. (NB: <code><a href="../reference/vim.html">vim()</a></code> takes care
of this under the hood, but it is worth noting that the large and small
oracle prediction functions for this analysis are estimated by
regressing the conditional survival function estimates given
<strong>all</strong> features on the relevant reduced feature set. As in
the previous analysis, this step is necessary to account for censoring
that may be informed by covariates, even those which are not included in
the current set of predictors.)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For importance relative to baseline features, the 'small' model uses only person-level (baseline) features</span></span>
<span><span class="co"># The 'large' model uses baseline + feature of interest</span></span>
<span><span class="va">size_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">size_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">nodes_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nodes_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">pgr_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pgr_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">er_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">er_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">grade_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">grade_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_group_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"nodes"</span>, <span class="st">"prog."</span>, <span class="st">"estro."</span>, <span class="st">"grade"</span><span class="op">)</span></span>
<span><span class="va">feature_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">size_index</span>, <span class="va">nodes_index</span>,</span>
<span>                    <span class="va">pgr_index</span>, <span class="va">er_index</span>, <span class="va">grade_index</span><span class="op">)</span></span>
<span></span>
<span><span class="va">person_index_numeric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">person_index</span>, split <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_group_names</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">indx_char</span> <span class="op">&lt;-</span> <span class="va">feature_groups</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="va">feature_group_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">indx_char</span>, split <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                event <span class="op">=</span> <span class="va">event</span>,</span>
<span>                X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                landmark_times <span class="op">=</span> <span class="va">landmark_times</span>,</span>
<span>                approx_times <span class="op">=</span> <span class="va">saved_approx_times</span>,</span>
<span>                large_feature_vector <span class="op">=</span> <span class="va">indx</span>,</span>
<span>                small_feature_vector <span class="op">=</span>  <span class="va">person_index_numeric</span>,</span>
<span>                conditional_surv_preds <span class="op">=</span> <span class="va">saved_conditional_surv_preds</span>,</span>
<span>                large_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                small_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                cf_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">cf_folds</span>,</span>
<span>                ss_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">ss_folds</span>,</span>
<span>                sample_split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                scale_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">saved_small_oracle_preds</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">small_oracle_preds</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                event <span class="op">=</span> <span class="va">event</span>,</span>
<span>                X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                landmark_times <span class="op">=</span> <span class="va">landmark_times</span>,</span>
<span>                approx_times <span class="op">=</span> <span class="va">saved_approx_times</span>,</span>
<span>                large_feature_vector <span class="op">=</span> <span class="va">indx</span>,</span>
<span>                small_feature_vector <span class="op">=</span>  <span class="va">person_index_numeric</span>,</span>
<span>                conditional_surv_preds <span class="op">=</span> <span class="va">saved_conditional_surv_preds</span>,</span>
<span>                small_oracle_preds <span class="op">=</span> <span class="va">saved_small_oracle_preds</span>,</span>
<span>                large_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                cf_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">cf_folds</span>,</span>
<span>                ss_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">ss_folds</span>,</span>
<span>                sample_split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                scale_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_char</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pooled_output</span>, <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">result</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">p_auc</span> <span class="op">&lt;-</span> <span class="fu">plot_results</span><span class="op">(</span><span class="va">pooled_output</span>, <span class="st">"AUC variable importance relative to person-level features"</span><span class="op">)</span></span>
<span><span class="va">p_auc</span></span></code></pre></div>
<p><img src="variable_importance_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="adjustment-variables">Adjustment variables<a class="anchor" aria-label="anchor" href="#adjustment-variables"></a>
</h3>
<p>There may be covariates that are thought to influence both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
but are not of scientific interest in terms of variable importance. (We
may think of these covariates as analogous to confounders in a causal
inference setting.) It is important to adjust for these variables in all
analyses. In the <code>gbsg</code> analysis, for example, we may wish to
adjust for person-level covariates age, menopausal status, and hormone
treatment therapy, but to assess variable importance using only the
predictiveness of tumor-level covariates.</p>
<p>We use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
to denote the index set of adjustment variables, and again use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
to denote the index set of variables of interest. The importance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>s</mi></msub><annotation encoding="application/x-tex">X_s</annotation></semantics></math>
relative to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mo>−</mo><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">X_{-r}</annotation></semantics></math>
(i.e., the full covariate vector excluding adjustment variables) is
given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>f</mi><mrow><mn>0</mn><mo>,</mo><mi>r</mi></mrow></msub><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>f</mi><mrow><mn>0</mn><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo>∪</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(f_{0, r}, P_0) - V(f_{0, (r \cup s)}, P_0)</annotation></semantics></math>.</p>
<p>Here, we analyze VIM relative to tumor-level covariates, while
adjusting for person-level covariates. This time, the large feature
vector consists of all features except for person-level features, and
remains the same as we examine each of the other feature groups. Note
that in the first iteration of the loop, we save the large oracle
prediction function estimates to recycle for other feature group VIM
estimates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">size_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">nodes_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nodes_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">pgr_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pgr_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">er_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">er_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">grade_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">grade_index</span>, <span class="va">person_index</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_group_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"nodes"</span>, <span class="st">"prog."</span>, <span class="st">"estro."</span>, <span class="st">"grade"</span><span class="op">)</span></span>
<span><span class="va">feature_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">size_index</span>, <span class="va">nodes_index</span>,</span>
<span>                    <span class="va">pgr_index</span>, <span class="va">er_index</span>, <span class="va">grade_index</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_group_names</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">indx_char</span> <span class="op">&lt;-</span> <span class="va">feature_groups</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="va">feature_group_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">indx_char</span>, split <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>     <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                event <span class="op">=</span> <span class="va">event</span>,</span>
<span>                X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                landmark_times <span class="op">=</span> <span class="va">landmark_times</span>,</span>
<span>                approx_times <span class="op">=</span> <span class="va">saved_approx_times</span>,</span>
<span>                large_feature_vector <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">person_index_numeric</span><span class="op">]</span>,</span>
<span>                small_feature_vector <span class="op">=</span>  <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">indx</span><span class="op">]</span>,</span>
<span>                conditional_surv_preds <span class="op">=</span> <span class="va">saved_conditional_surv_preds</span>,</span>
<span>                large_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                small_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                cf_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">cf_folds</span>,</span>
<span>                ss_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">ss_folds</span>,</span>
<span>                sample_split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                scale_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="va">saved_large_oracle_preds</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">large_oracle_preds</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>     <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                event <span class="op">=</span> <span class="va">event</span>,</span>
<span>                X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                landmark_times <span class="op">=</span> <span class="va">landmark_times</span>,</span>
<span>                approx_times <span class="op">=</span> <span class="va">saved_approx_times</span>,</span>
<span>                large_feature_vector <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">person_index_numeric</span><span class="op">]</span>,</span>
<span>                small_feature_vector <span class="op">=</span>  <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">indx</span><span class="op">]</span>,</span>
<span>                conditional_surv_preds <span class="op">=</span> <span class="va">saved_conditional_surv_preds</span>,</span>
<span>                large_oracle_preds <span class="op">=</span> <span class="va">saved_large_oracle_preds</span>,</span>
<span>                small_oracle_generator_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span><span class="op">)</span>,</span>
<span>                                                      V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                cf_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">cf_folds</span>,</span>
<span>                ss_folds <span class="op">=</span> <span class="va">saved_folds</span><span class="op">$</span><span class="va">ss_folds</span>,</span>
<span>                sample_split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                scale_est <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_char</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">indx_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">indx_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pooled_output</span>, <span class="va">output</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">pooled_output</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">result</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">p_auc</span> <span class="op">&lt;-</span> <span class="fu">plot_results</span><span class="op">(</span><span class="va">pooled_output</span>, <span class="st">"Adjusted AUC variable importance relative to all tumor-level features"</span><span class="op">)</span></span>
<span><span class="va">p_auc</span></span></code></pre></div>
<p><img src="variable_importance_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<p>Some example predictiveness measures, along with the corresponding
oracle prediction functions, are given below.</p>
<ul>
<li>
<em>AUC</em>:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">{</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>∣</mo><msub><mi>T</mi><mn>1</mn></msub><mo>≤</mo><mi>τ</mi><mo>,</mo><msub><mi>T</mi><mn>2</mn></msub><mo>&gt;</mo><mi>τ</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">V(f, P_0) = P_0\{f(X_1) &gt; f(X_2) \mid T_1 \leq \tau, T_2 &gt; \tau\}</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>S</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_0(x) = 1 - S_0(\tau \mid x)</annotation></semantics></math></li>
</ul>
</li>
<li>
<em>Brier score</em>:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>E</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><mo stretchy="false" form="prefix">{</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><msup><mo stretchy="false" form="postfix">}</mo><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">V(f, P_0) = E_{P_0}[\{f(X) - I(T \leq \tau)\}^2]</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>S</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_0(x) = 1 - S_0(\tau \mid x)</annotation></semantics></math></li>
</ul>
</li>
<li>
<em>Survival time MSE</em>:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>E</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><mo stretchy="false" form="prefix">{</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>∧</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><msup><mo stretchy="false" form="postfix">}</mo><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">V(f, P_0) = E_{P_0}[\{f(X) - (T \wedge \tau)\}^2]</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>τ</mi></msubsup><msub><mi>S</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">f_0(x) = \int_0^\tau S_0(t \mid x)dt</annotation></semantics></math></li>
</ul>
</li>
<li>
<em>Proportion of explained variance (R-squared)</em>:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msub><mi>E</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><mo stretchy="false" form="prefix">{</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><msup><mo stretchy="false" form="postfix">}</mo><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mi>v</mi><mi>a</mi><msub><mi>r</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">V(f, P_0) = \frac{E_{P_0}[\{f(X) - I(T \leq \tau)\}^2]}{var_{P_0}[I(T \leq \tau)]}</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>S</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_0(x) = 1 - S_0(\tau \mid x)</annotation></semantics></math></li>
</ul>
</li>
<li>
<em>Binary classification accuracy</em>:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">{</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">V(f, P_0) = P_0\{f(X) = I(T \leq \tau)\}</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mo stretchy="false" form="prefix">{</mo><msub><mi>S</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo>∣</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≤</mo><mn>0.5</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">f_0(x) = I\{S_0(\tau \mid x) \leq 0.5\}</annotation></semantics></math></li>
</ul>
</li>
<li>
<em>C-index</em>:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">{</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>∣</mo><msub><mi>T</mi><mn>1</mn></msub><mo>≤</mo><msub><mi>T</mi><mn>2</mn></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">V(f, P_0) = P_0\{f(X_1) &gt; f(X_2) \mid T_1 \leq T_2\}</annotation></semantics></math></li>
<li>For the C-index, there is, to our knowledge, no closed form of the
oracle prediction function; see the preprint for more details on our
proposed procedure for direct numerical optimization.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>The survival variable importance methodology is described in</p>
<p>Charles J. Wolock, Peter B. Gilbert, Noah Simon and Marco Carone. <a href="https://arxiv.org/abs/2311.12726" class="external-link">“Assessing variable importance
in survival analysis using machine learning.”</a> In press,
<em>Biometrika</em> (2024).</p>
<p>Other references:</p>
<p>David R. Cox. <a href="https://doi.org/10.1111/j.2517-6161.1972.tb00899.x" class="external-link">“Regression
Models and Life-Tables.”</a> <em>Journal of the Royal Statistical
Society: Series B (Methodological)</em> (1972).</p>
<p>Ted Westling, Alex Luedtke, Peter B. Gilbert and Marco Carone. <a href="https://www.tandfonline.com/doi/full/10.1080/01621459.2023.2205060" class="external-link">“Inference
for treatment-specific survival curves using machine learning.”</a>
<em>Journal of the American Statistical Association</em> (2023).</p>
<p>Charles J. Wolock, Peter B. Gilbert, Noah Simon and Marco Carone. <a href="https://www.tandfonline.com/doi/full/10.1080/10618600.2024.2304070" class="external-link">“A
framework for leveraging machine learning tools to estimate personalized
survival curves.”</a> <em>Journal of Computational and Graphical
Statistics</em> (2024).</p>
<p>Mark J. van der Laan, Eric C. Polley and Alan E. Hubbard. <a href="https://doi.org/10.2202/1544-6115.1309" class="external-link">“Super learner.”</a>
<em>Statistical Applications in Genetics and Molecular Biology</em>
(2007).</p>
<p>Daniel Rubin and Mark J. van der Laan. <a href="https://doi.org/10.2202/1557-4679.1052" class="external-link">“A doubly robust censoring
unbiased transformation.”</a> <em>International Journal of
Biostatistics</em> (2007).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charles Wolock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
